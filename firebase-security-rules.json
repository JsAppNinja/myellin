{
  "rules": {
    "outcomes": {
      ".indexOn": ["slug"],
      ".read": true,
      "$outcome": {
          // Only admins can create outcomes. Non-admins can update an existing playlist_count field by 1.
          "playlist_count": {
            ".write": "auth != null &&
                        (
                          // Must be an admin
                          root.child('users/' + auth.uid + '/admin').val() === true ||
                          // Or be incrementing/de-incrementing the value of playlist_count by 1 (this happens when they create/delete a playlist)
                          data.exists() && newData.val() === data.val() + 1 ||
                          data.exists() && newData.val() === data.val() - 1
                        )"
          },
          // All other fields can only be written by admins
         "$other": {
            ".write": "auth != null && 
                        root.child('users/' + auth.uid + '/admin').val() === true"
         }
      }  
    },
    "relations": {
      ".read": true,
      "section_to_outcome": {
        "home": {
          "$outcome": {
            // Must be an admin to add an outcome to the homepage
            ".write": "auth != null && root.child('users/' + auth.uid + '/admin').val() === true"
          }
        }
      },
      // Other paths are writeable by anyone for now
      "$other": {
        ".write": true
      }
    },
    "playlists": {
      ".read": true,
      ".write": true,
      "$playlist": {
        ".write": true
      }
    },
    "options": {
      ".read": true,
      "$option": {
          // Must be logged in AND either creating new data or updating existing data belonging to you
         ".write": "auth != null && 
                      (!data.exists() || data.child('author_id').val() == auth.uid)",
          // Must include required children, author_id must match auth.id, and description must be a string
         ".validate": "newData.hasChildren(['author_id', 'description']) && 
                        newData.child('author_id').val() == auth.uid && 
                          newData.child('description').isString()"
      }
    },
    "suboutcomes": {
      ".read": true,
      "$option": {
        // TODO: only let author edit/delete, but allow anyone to increment option_count by 1 (since other people can add options)
        ".write": true
      }
    },
    "users": {
      ".read": true,
      ".write": true
    },
    "upvotes": {
      ".read": true,
      ".write": true
    }
  }
}